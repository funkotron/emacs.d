(ns client
  (:require
   [dommy.core :as dommy]
   [shoreleave.remotes.http-rpc :as rpc])
  (:use [jayq.core :only [$ text document]]
        [jayq.util :only [log wait]])
  
  (:use-macros
   [dommy.macros :only [sel sel1 node deftemplate]]))
(set! shoreleave.remotes.http-rpc/*remote-uri* "/_fetch")

(defn print-decrypt [encrypted] (log (.decrypt js/sjcl "password" encrypted)))
(rpc/remote-callback :get-message [] #(print-decrypt %))

(deftemplate simple-template []
  [:div
   [:input {:type "text" :id "pass" :value "password"}]
   [:input {:type "text" :id "data" :value "data"}]
   [:button {:class "send-button"} "Send"]
   ])

(dommy/append! (sel1 :.container) (simple-template))

(.click ($ :.send-button) #(rpc/remote-callback :send-message [(.encrypt js/sjcl (dommy/value (sel1 :#pass))
                                                                         (dommy/value (sel1 :#data)))
                                                               ]
                                            (fn [] (log "done")))
    (rpc/remote-callback :get-message [] #(log %)))


